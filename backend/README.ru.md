# üé∂ Soundroom Backend

Backend-—á–∞—Å—Ç—å –º—É–∑—ã–∫–∞–ª—å–Ω–æ–≥–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è **Soundroom** –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è —Ç—Ä–µ–∫–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç GraphQL API, real-time –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—É–∑—ã–∫–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º.

## üìå –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

–í –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∫–ª—é—á–µ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.

## ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

* –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (JWT, refresh token)
* Google OAuth
* –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (2FA)
* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ä—Ç–∏—Å—Ç–∞–º–∏, —Ç—Ä–µ–∫–∞–º–∏ –∏ –ø–ª–µ–π–ª–∏—Å—Ç–∞–º–∏
* –ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∏
* –°–∏—Å—Ç–µ–º–∞ –¥—Ä—É–∑–µ–π –∏ –∑–∞—è–≤–∫–∏ –≤ –¥—Ä—É–∑—å—è
* GraphQL API
* Real-time –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∫–æ–º–Ω–∞—Ç–∞—Ö
* WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
* –†–∞–±–æ—Ç–∞ —Å –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞–º–∏

## üõ† –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

* **NestJS**
* **TypeScript**
* **GraphQL (Apollo Server)**
* **WebSocket (Socket.IO)**
* **PostgreSQL**
* **TypeORM**
* **Prisma**
* **Redis**
* **JWT / Passport**
* **Supabase**
* **FFmpeg**
* **Jest**

## üåê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (Backend)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:

```bash
cp .env.example .env
```

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è         | –û–ø–∏—Å–∞–Ω–∏–µ             |
| ------------------ | -------------------- |
| DB_HOST            | –•–æ—Å—Ç PostgreSQL      |
| DB_PORT            | –ü–æ—Ä—Ç PostgreSQL      |
| DB_USERNAME        | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î      |
| DB_PASSWORD        | –ü–∞—Ä–æ–ª—å –ë–î            |
| DB_DATABASE        | –ù–∞–∑–≤–∞–Ω–∏–µ –ë–î          |
| SUPABASE_URL       | URL Supabase         |
| SUPABASE_DIRECT    | URL Supabase         |
| SUPABASE_KEY       | Service Role Key     |
| JWT_ACCESS_SECRET  | –°–µ–∫—Ä–µ—Ç access token  |
| JWT_REFRESH_SECRET | –°–µ–∫—Ä–µ—Ç refresh token |
| JWT_2FA_SECRET     | –°–µ–∫—Ä–µ—Ç 2FA           |

## GraphQL API

API —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–∞ –±–∞–∑–µ **NestJS + Apollo Server**. –°—Ö–µ–º–∞ GraphQL –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

–û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏:

* User
* Artist
* Track
* Playlist
* FriendRequest

## ‚ö° Real-time

* –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ WebSocket
* –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∫–æ–º–Ω–∞—Ç–µ
* –û–±–º–µ–Ω —Å–æ–±—ã—Ç–∏—è–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## üóÑ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **PostgreSQL**. –õ–æ–≥–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü:

### `users`

| –ü–æ–ª–µ         | –¢–∏–ø      | –û–ø–∏—Å–∞–Ω–∏–µ                   |
| ------------ | -------- | -------------------------- |
| id           | UUID     | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| email        | string   | Email                      |
| password     | string   | –•–µ—à –ø–∞—Ä–æ–ª—è                 |
| username     | string   | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è           |
| tag          | string   | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–µ–≥             |
| userAvatar   | string   | –ê–≤–∞—Ç–∞—Ä                     |
| provider     | string   | –ü—Ä–æ–≤–∞–π–¥–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏      |
| refreshToken | string   | Refresh token              |
| createdAt    | DateTime | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è              |
| updatedAt    | DateTime | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è            |

### `artists`

| –ü–æ–ª–µ     | –¢–∏–ø    | –û–ø–∏—Å–∞–Ω–∏–µ              |
| -------- | ------ | --------------------- |
| id       | UUID   | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∞—Ä—Ç–∏—Å—Ç–∞ |
| name     | string | –ò–º—è                   |
| genre    | string | –ñ–∞–Ω—Ä                  |
| imageUrl | string | –û–±–ª–æ–∂–∫–∞               |

### `tracks`

| –ü–æ–ª–µ       | –¢–∏–ø      | –û–ø–∏—Å–∞–Ω–∏–µ            |
| ---------- | -------- | ------------------- |
| id         | UUID     | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç—Ä–µ–∫–∞ |
| name       | string   | –ù–∞–∑–≤–∞–Ω–∏–µ            |
| genre      | string   | –ñ–∞–Ω—Ä                |
| duration   | number   | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å        |
| urlFile    | string   | URL –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞      |
| artistId   | UUID     | –ê—Ä—Ç–∏—Å—Ç              |
| created_at | DateTime | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è       |

### `playlists`

| –ü–æ–ª–µ      | –¢–∏–ø      | –û–ø–∏—Å–∞–Ω–∏–µ                |
| --------- | -------- | ----------------------- |
| id        | UUID     | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–ª–µ–π–ª–∏—Å—Ç–∞ |
| name      | string   | –ù–∞–∑–≤–∞–Ω–∏–µ                |
| imageUrl  | string   | –û–±–ª–æ–∂–∫–∞                 |
| userId    | UUID     | –í–ª–∞–¥–µ–ª–µ—Ü                |
| createdAt | DateTime | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è           |
| updatedAt | DateTime | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è         |

### `playlist_tracks`

| –ü–æ–ª–µ       | –¢–∏–ø  | –û–ø–∏—Å–∞–Ω–∏–µ |
| ---------- | ---- | -------- |
| playlistId | UUID | –ü–ª–µ–π–ª–∏—Å—Ç |
| trackId    | UUID | –¢—Ä–µ–∫     |

### `favorites`

| –ü–æ–ª–µ    | –¢–∏–ø  | –û–ø–∏—Å–∞–Ω–∏–µ       |
| ------- | ---- | -------------- |
| userId  | UUID | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å   |
| trackId | UUID | –ò–∑–±—Ä–∞–Ω–Ω—ã–π —Ç—Ä–µ–∫ |

### `friend_requests`

| –ü–æ–ª–µ        | –¢–∏–ø      | –û–ø–∏—Å–∞–Ω–∏–µ      |
| ----------- | -------- | ------------- |
| id          | UUID     | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| requesterId | UUID     | –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å   |
| receiverId  | UUID     | –ü–æ–ª—É—á–∞—Ç–µ–ª—å    |
| createdAt   | DateTime | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

### `rooms`

| –ü–æ–ª–µ      | –¢–∏–ø      | –û–ø–∏—Å–∞–Ω–∏–µ              |
| --------- | -------- | --------------------- |
| id        | UUID     | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ–º–Ω–∞—Ç—ã |
| hostId    | UUID     | –°–æ–∑–¥–∞—Ç–µ–ª—å –∫–æ–º–Ω–∞—Ç—ã     |
| createdAt | DateTime | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è         |

### `room_users`

| –ü–æ–ª–µ   | –¢–∏–ø  | –û–ø–∏—Å–∞–Ω–∏–µ     |
| ------ | ---- | ------------ |
| roomId | UUID | –ö–æ–º–Ω–∞—Ç–∞      |
| userId | UUID | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* JWT access / refresh tokens
* –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (TOTP)
* –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (bcrypt)
* –ó–∞—â–∏—Ç–∞ GraphQL –∏ WebSocket-—ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

* Node.js >= 18
* npm
* PostgreSQL

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
git clone https://github.com/username/soundroom-backend.git
cd soundroom-backend
npm install
```

### –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**

```bash
npm run start:dev
```

**Production**

```bash
npm run build
npm run start:prod
```

### –î–æ—Å—Ç—É–ø

* Frontend: [http://localhost:4000](http://localhost:4000)
